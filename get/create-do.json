add_field('language','eng')
move_field('restrictions_apply','restrictions')

remove_field('resource.ref')
# extract unique parent ID
substring('parent.ref',33,37)

# perform lookup
do list(path => parent)
  lookup("ref","lookup_blake.csv");
end

# move title
move_field('title','digital_object_id')

# flatten title
move_field('parent.ref','title')

remove_field('level')
add_field('digital_object_type','still_image')
add_field('level','image')

# [json] create external id
#   hash => digital_object_id
paste(external_ids.0.external_id,digital_object_id)
add_field('external_ids.0.source','digital_object_id hashed by Catmandu')
md5sum('external_ids.0.external_id')

# [json] file versions
copy_field('digital_object_id','digital_object_id_uri')
replace_all('digital_object_id_uri','\.','_')
replace_all('digital_object_id_uri','\w ','')
copy_field("digital_object_id_uri","file_versions.0.file_uri")
prepend("file_versions.0.file_uri","http://eu-dhc.s3.amazonaws.com/master/blake/")
append("file_versions.0.file_uri",".tif")
add_field("file_versions.0.use_statement","image-master")
add_field("file_versions.0.xlink_actuate_attribute","onLoad")
add_field("file_versions.0.xlink_show_attribute","embed")
add_field("file_versions.0.file_format_name","tiff")
add_field("file_versions.0.publish","true")

copy_field("digital_object_id_uri","file_versions.1.file_uri")
prepend("file_versions.1.file_uri","http://eu-dhc.s3.amazonaws.com/service/blake/")
append("file_versions.1.file_uri",".jpg")
add_field("file_versions.1.use_statement","image-service")
add_field("file_versions.1.xlink_actuate_attribute","onLoad")
add_field("file_versions.1.xlink_show_attribute","embed")
add_field("file_versions.1.file_format_name","jpeg")
add_field("file_versions.1.publish","true")

remove_field("suppress")

remove_field('digital_object_id_uri')

add_field('collection_management.processors','Digital object records processed by Minor Science. Koha-to-repository crosswalks available here [http://dhc.aarome.org/crosswalks].')
add_field('collection_management.rights_determined','true')
add_field('collection_management.processing_started_date','2016-08-15')
add_field('collection_management.processing_status','new')
add_field('collection_management.processing_priority','medium')

# [json] rights statement
remove_field("rights_statements")
add_field('rights_statements.0.permissions','Publication restricted. [https://dhc.aarome.org/copyright]')
add_field('rights_statements.0.restrictions','Closed access material. [https://dhc.aarome.org/usage]')
add_field('rights_statements.0.active','true')
add_field('rights_statements.0.rights_type','institutional_policy')
add_field('rights_statements.0.restriction_start_date','2016-08-15')

# [json] housekeeping
remove_field('call_number_suffix')
remove_field('lname')
remove_field('fname')
remove_field('corporate_entity_ref_0')
remove_field('linked_agent_ref_0')
remove_field('linked_agent_ref_1')
remove_field('description')
remove_field('legacy_filename')
remove_field('pid')
remove_field('digital_object_id_hash')
remove_field('call_number_0')
remove_field('external_id')
remove_field('external_id')
remove_field('phys_descr')
remove_field('ref_id')
remove_field('parent_id')
remove_field('call_prefix')
remove_field('call_number')
remove_field('certainty')
remove_field('linked_agent_ref')
remove_field('creator')
remove_field('series')
remove_field('subseries')
remove_field('sub subseries')
remove_field('note')
remove_field('sub sub subseries')
remove_field('id')
remove_field('mid')
remove_field('begin')
remove_field('end')
remove_field('expression')
remove_field('physical_details')
remove_field('subject_ref_1')
remove_field('subject_ref_2')
remove_field('subject_ref_3')
remove_field('subject_ref_4')
remove_field('subject_ref_5')
remove_field('subject_ref_6')
remove_field('subject_ref_1_id')
remove_field('subject_ref_2_id')
remove_field('subject_ref_3_id')
remove_field('subject_ref_4_id')
remove_field('subject_ref_5_id')
remove_field('subject_ref_6_id')
remove_field('extent_type')
remove_field('extent_number')
remove_field('dimensions')
remove_field('location_ref')
remove_field('new_filename')
remove_field('notes_negative')
remove_field('type')
remove_field('notes_negative')
remove_field('order')
remove_field('is_top')
remove_field('is_other_level')
remove_field('item_parent')
remove_field('is_item')
remove_field('test')
remove_field('other_level_group_old')
remove_field('item_level_group_old')
remove_field('item_level_group')
remove_field('other_level_group')
remove_field('linked_agent_ref_2')
remove_field('extents')
remove_field('instances')
remove_field('linked_agents')
remove_field('user_mtime')
remove_field('linked_events')
remove_field('dates')
remove_field('system_mtime')
remove_field('external_documents')
remove_field('subjects')
remove_field('create_time')
remove_field('last_modified_by')
remove_field('lock_version')
remove_field('parent')
remove_field('display_string')
remove_field('notes')
remove_field('created_by')
remove_field('jsonmodel_type')
remove_field('resource')
remove_field('position')
remove_field('uri')
remove_field('has_unpublished_ancestor')
